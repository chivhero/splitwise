#!/bin/bash
# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è Telegram Mini App

echo "üöÄ –ó–∞–ø—É—Å–∫ SplitWise Telegram Mini App..."
echo ""

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è Node.js
export PATH="$HOME/.local/bin:$PATH"
eval "$(fnm env --shell bash)"
fnm use 20

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω
if lsof -Pi :3000 -sTCP:LISTEN -t >/dev/null 2>&1; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 3000 —É–∂–µ –∑–∞–Ω—è—Ç. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç."
    exit 1
fi

# –ó–∞–ø—É—Å–∫ Next.js dev server
echo "üì¶ –ó–∞–ø—É—Å–∫ Next.js dev server..."
npm run dev > /dev/null 2>&1 &
DEV_PID=$!
echo "‚úÖ Dev server –∑–∞–ø—É—â–µ–Ω (PID: $DEV_PID)"

# –ñ–¥—ë–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
sleep 3

# –ó–∞–ø—É—Å–∫ localtunnel
echo "üåê –ó–∞–ø—É—Å–∫ localtunnel..."
npx localtunnel --port 3000 &
LT_PID=$!
echo "‚úÖ Localtunnel –∑–∞–ø—É—â–µ–Ω (PID: $LT_PID)"

# –ñ–¥—ë–º –ø–æ–ª—É—á–µ–Ω–∏—è URL
sleep 2

echo ""
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "‚úÖ –í—Å—ë –∑–∞–ø—É—â–µ–Ω–æ!"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo "üì± –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞: https://t.me/SplitWisedbot"
echo ""
echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PID –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
echo "$DEV_PID $LT_PID" > .running_pids

# –û–∂–∏–¥–∞–Ω–∏–µ
wait
